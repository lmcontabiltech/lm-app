<div class="main-container">
    <div class="title-container">
        <h2>Bem-vindo(a), {{ usuario?.nome }}</h2>
    </div>
    <div class="cards-container">
        <div class="cards-moedas">
            <div class="card moeda-card">
                <div class="value">
                    <span>{{ cotacoes.euro | number:'1.2-2' }}</span>
                    <img src="assets/icones/dashboard/euro.svg" alt="moeda euro">
                </div>
                <p>€1,00 EUR = R${{ (cotacoes.euro * 1000) | number:'1.0-0' }} BRL</p>
            </div>
            <div class="card moeda-card">
                <div class="value">
                    <span>{{ cotacoes.dolar | number:'1.2-2' }}</span>
                    <img src="assets/icones/dashboard/dolar.svg" alt="moeda dolar">
                </div>
                <p>$1,00 USD = R${{ (cotacoes.dolar * 1000) | number:'1.0-0' }} BRL</p>
            </div>
            <div class="card moeda-card">
                <div class="value">
                  <span>{{ selic }}%</span>
                  <img src="assets/icones/dashboard/aumento.svg" alt="aumento">
                </div>
                <p>Taxa Selic</p>
              </div>              
        </div>
    </div>

    <div class="cards-setores" *ngIf="setorUsuario.nome">
        <div class="card">
            <div class="title">
                <span>{{ setorUsuario.nome }}</span>
                <img [src]="'assets/icones/dashboard/' + setorUsuario.icone">
            </div>
            <div class="progress">
                <label>Atividades concluídas</label>
                <div class="progresso-atividade-container">
                    <div class="progresso-atividade-bar">
                        <div class="progresso-atividade-fill" [style.width.%]="setorUsuario.porcentagem"></div>
                    </div>
                    <p class="progresso-atividade-porcentagem">{{ setorUsuario.porcentagem }}%</p>
                </div>
            </div>
        </div>
    </div>
 
    <div class="cards-infos">
            <div class="card">
            <div class="qtd">
                <span>{{ resumoAtividadesUsuario.totalAtribuidas }}</span>
                <img src="assets/icones/dashboard/add-user.svg" alt="pessoas" />
            </div>
            <p>Tarefas atribuídas</p>
            </div>
            <div class="card">
            <div class="qtd">
                <span>{{ resumoAtividadesUsuario.emAndamento }}</span>
                <img src="assets/icones/dashboard/calendario.svg" alt="predios" />
            </div>
            <p>Em progresso</p>
            </div>
            <div class="card">
            <div class="qtd">
                <span>{{ resumoAtividadesUsuario.concluidas }}</span>
                <img src="assets/icones/dashboard/check.svg" alt="pessoa" />
            </div>
            <p>Concluídas</p>
        </div>
    </div>

    <!-- <div class="me-atividades">
        <div class="title-grafico">
                <h3>Atribuídas a mim</h3>
                <div class="select-container">
                    <app-select-padrao
                        label="Período"
                        [options]="periodos"
                        [(selectedValue)]="periodoSelecionado"
                        (selectedValueChange)="onPeriodoChange($event)"
                        [showDefaultOption]="true"
                        [defaultLabel]="'Sem período'"
                        [defaultValue]="''"
                        [customStyles]="{ 'background-color': '#f8f9fa' }">
                    </app-select-padrao>
                </div>
            </div>
        <div class="atividade-container">
            <div class="atividade-item">
                <span class="titulo-atividade">Processos</span>
                <span class="status-tag" 
                      [style.color]="getStatusConfig(atividade.status).color"
                      [style.background-color]="getStatusConfig(atividade.status).background"
                      [style.border]="'1px solid ' + getStatusConfig(atividade.status).color + '33'">
                    {{ getStatusConfig(atividade.status).label }}
                </span>
                <div class="data-atividade">
                    <span>24/05/2025</span> - <span>29/05/2025</span>
                </div>
            </div>
        </div>
    </div> -->

    <div class="graficos-container">
        <div>
             <div class="title-grafico">
                <h3>
                    Atividades do Setor {{ nomeSetorGrafico }}
                </h3>
                <div class="select-container">
                    <app-select-padrao
                        label="Período"
                        [options]="periodos"
                        [(selectedValue)]="periodoSelecionado"
                        (selectedValueChange)="onPeriodoChange($event)"
                        [showDefaultOption]="true"
                        [defaultLabel]="'Sem período'"
                        [defaultValue]="''"
                        [customStyles]="{ 'background-color': '#f8f9fa' }">
                    </app-select-padrao>
                </div>
            </div>
            <div class="duo-container">
                <app-grafico-barra-horizontal
                    [series]="[{ name: 'Abertas', data: [
                        atividadesResumoSetor?.abertas?.noPrazo ?? 0,
                        atividadesResumoSetor?.abertas?.emAtraso ?? 0,
                        atividadesResumoSetor?.abertas?.comMultas ?? 0
                    ] }]"
                    [categories]="['No prazo', 'Em atraso', 'Com multas']"
                    [colors]="['#FEB019']"
                    title="Abertas">
                </app-grafico-barra-horizontal>
                <app-grafico-barra-horizontal
                    [series]="[{ name: 'Concluídas', data: [
                        atividadesResumoSetor?.concluidas?.noPrazo ?? 0,
                        atividadesResumoSetor?.concluidas?.emAtraso ?? 0,
                        atividadesResumoSetor?.concluidas?.comMultas ?? 0
                    ] }]"
                    [categories]="['No prazo', 'Em atraso', 'Com multas']"
                    [colors]="['#1fde82']"
                    title="Concluídas">
                </app-grafico-barra-horizontal>
            </div>
        </div>
    </div>

     <div id="geral">
        <div class="title-grafico">
            <h3> 
                Desempenho das atividades
            </h3>
        </div>

        <app-grafico-linha
            [series]="graficoAtividadesMensaisSetor.series"
            [categories]="graficoAtividadesMensaisSetor.categories"
            [colors]="['#5EA828']"
            title="Atividades concluidas por mês"
            totalLabel="Total"
            [showTotal]="true"
            [subtitle]="'Total: ' + totalAtividadesPorMes">
        </app-grafico-linha>
    </div>
</div>

<!-- <ng-template #videoModalTemplate>
    <div class="video-container" style="padding:16px 0;">
        <div style="position:relative;padding-bottom:56.25%;height:0;overflow:hidden;border-radius:8px;">
        <iframe
            [src]="safeVideoUrl"
            style="position:absolute;top:0;left:0;width:100%;height:100%;border:0;"
            allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture"
            allowfullscreen
        ></iframe>
        </div>
    </div>
</ng-template>

<ng-template #anuncioTemplate>
    <div class="anuncio" style="padding:16px; text-align: center;">
        <p style="font-size: 16px; line-height: 1.6; color: #333;">
            Todas as mensagens do BOT estão sendo visualizadas e em breve respondidas
        </p>
    </div>
</ng-template> -->

<ng-template #anuncioModalTemplate>
  <div class="anuncio-modal" style="padding:16px;">
    <div class="anuncio-carousel" style="min-height:120px; display:flex; flex-direction:column; justify-content:space-between;">
      <div class="anuncio-item" style="flex:1; display:flex; align-items:center; justify-content:center; padding:8px;">
        <p style="font-size:16px; line-height:1.6; color:#333; text-align:center; margin:0;">
          {{ anuncios[currentAnuncioIndex] }}
        </p>
      </div>

      <div class="carousel-controls">
       <div class="paginacao">
          <button (click)="prevAnuncio()" [disabled]="currentAnuncioIndex === 0" [class.ativo]="currentAnuncioIndex > 0">
            <img src="assets/icones/carret-left.svg" alt="Esquerda">
          </button>
          <span style="align-self:center;">{{ currentAnuncioIndex + 1 }} / {{ anuncios.length }}</span>
          <button (click)="nextAnuncio()" [disabled]="currentAnuncioIndex === (anuncios.length - 1)" [class.ativo]="currentAnuncioIndex !== (anuncios.length - 1)">
            <img src="assets/icones/carret-right.svg" alt="Direita">
          </button>
        </div>
      </div>
    </div>
  </div>
</ng-template>